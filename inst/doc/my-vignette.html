<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Hengxin Li, Mingbin Feng, Mingyi Jiang" />

<meta name="date" content="2020-02-26" />

<title>A Comprehensive Monte Carlo Valuation of Variable Annuities</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">A Comprehensive Monte Carlo Valuation of Variable Annuities</h1>
<h4 class="author">Hengxin Li, Mingbin Feng, Mingyi Jiang</h4>
<h4 class="date">2020-02-26</h4>



<div id="package-info" class="section level1">
<h1>Package Info</h1>
<p>This package uses Monte Carlo simulation to estimate the fair market value of a large portfolio of synthetic variable annuities. The portfolio of variable annuities under consideration is generated based on realistic features of common types of guarantee riders in North America. The Monte Carlo simulation engine generates sample paths of asset prices based on Black-Scholes model. In this vignette, we will demonstrate the functionalities provided in this package.</p>
<p>For illustrative purposes, we will use few scenarios to valuate a pool of two variable annuities. Users may obtain a more robust valuation result by increasing the amount of risk-neutral scenarios.</p>
<div id="yield-curve-generation" class="section level2">
<h2>Yield Curve Generation</h2>
<p>In this step, we exploit Secant method to calculate discount factors and forward rates at different tenor based on given swap rates using <code>buildCurve()</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Initialize required inputs to boostrap a curve</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>swap &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.69</span>, <span class="fl">0.77</span>, <span class="fl">0.88</span>, <span class="fl">1.01</span>, <span class="fl">1.14</span>, <span class="fl">1.38</span>, <span class="fl">1.66</span>, <span class="fl">2.15</span>)<span class="op">*</span><span class="fl">0.01</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>tenor &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">30</span>)</span>
<span id="cb1-4"><a href="#cb1-4"></a>fixFreq &lt;-<span class="st"> </span><span class="dv">6</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>fixDCC &lt;-<span class="st"> &quot;Thirty360&quot;</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>fltFreq &lt;-<span class="st"> </span><span class="dv">6</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>fltDCC &lt;-<span class="st"> &quot;ACT360&quot;</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>calendar &lt;-<span class="st"> &quot;General&quot;</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>bdc &lt;-<span class="st"> &quot;Modified_Foll&quot;</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>curveDate &lt;-<span class="st"> &quot;2016-02-08&quot;</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>numSetDay &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>yieldCurveDCC &lt;-<span class="st"> &quot;Thirty360&quot;</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>holidays &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co"># Bootstrap a forward curve </span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="kw">buildCurve</span>(swap, tenor, fixFreq, fixDCC, fltFreq, fltDCC, calendar, bdc,</span>
<span id="cb1-17"><a href="#cb1-17"></a>            curveDate, numSetDay, yieldCurveDCC, holidays)</span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="co">#&gt;      obsDate discountFac    zeroRate forwardCurve  dayCount</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co">#&gt; 1 2016-02-08   1.0000000 0.000000000  0.006912035  0.000000</span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="co">#&gt; 2 2017-02-10   0.9930975 0.006888125  0.008520036  1.005556</span></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="co">#&gt; 3 2018-02-10   0.9847078 0.007683825  0.011060713  2.005556</span></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="co">#&gt; 4 2019-02-10   0.9739354 0.008787170  0.014146403  3.005556</span></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="co">#&gt; 5 2020-02-10   0.9603499 0.010100373  0.016846310  4.005556</span></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="co">#&gt; 6 2021-02-10   0.9444396 0.011420029  0.020451281  5.005556</span></span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="co">#&gt; 7 2023-02-10   0.9073275 0.013882093  0.024514485  7.005556</span></span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="co">#&gt; 8 2026-02-10   0.8451708 0.016812319  0.032098279 10.005556</span></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="co">#&gt; 9 2046-02-10   0.5147311 0.022132923  0.032098279 30.005556</span></span></code></pre></div>
</div>
<div id="generate-index-scenarios-and-fund-scenarios" class="section level2">
<h2>Generate index scenarios and fund scenarios</h2>
<p>In the following example, we first simulate the index movements using <code>genIndexScen()</code>. Three of the inputs to <code>genIndexScen()</code> are stored as default data under variable names “mCov”, “indexNames”, and “cForwardCurve” respectively. For illustration purposes, we will simulate 100 scenarios for 360 steps with a step length dT = 1/12 and seed = 1.</p>
<p>The underlying model utilizes the <strong>multivariate Black-Scholes model</strong>. All the simulated index movements are stored in a <strong>3D-array</strong> with dimensions [number of Scenarios, number of Steps, number of Indices]</p>
<div id="default-covariance-matrix" class="section level3">
<h3>Default covariance matrix</h3>
<table>
<thead>
<tr class="header">
<th align="right">US</th>
<th align="right">SMALL</th>
<th align="right">INT</th>
<th align="right">FIXED</th>
<th align="right">MONEY</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.15</td>
<td align="right">0.0</td>
<td align="right">0.00</td>
<td align="right">0.000</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="right">0.00</td>
<td align="right">0.2</td>
<td align="right">0.00</td>
<td align="right">0.000</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="right">0.00</td>
<td align="right">0.0</td>
<td align="right">0.17</td>
<td align="right">0.000</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="right">0.00</td>
<td align="right">0.0</td>
<td align="right">0.00</td>
<td align="right">0.029</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="right">0.00</td>
<td align="right">0.0</td>
<td align="right">0.00</td>
<td align="right">0.000</td>
<td align="right">0.0061</td>
</tr>
</tbody>
</table>
</div>
<div id="default-index-names" class="section level3">
<h3>Default index names</h3>
<table>
<thead>
<tr class="header">
<th align="left">Index Names</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">US</td>
</tr>
<tr class="even">
<td align="left">SMALL</td>
</tr>
<tr class="odd">
<td align="left">INT</td>
</tr>
<tr class="even">
<td align="left">FIXED</td>
</tr>
<tr class="odd">
<td align="left">MONEY</td>
</tr>
</tbody>
</table>
</div>
<div id="risk-neutral-path-simulation-for-5-indices" class="section level3">
<h3>Risk-neutral path simulation for 5 indices</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># We will show the index simulated path for five months of the first scenario </span></span>
<span id="cb2-2"><a href="#cb2-2"></a>indexScen &lt;-<span class="st"> </span><span class="kw">genIndexScen</span>(mCov, <span class="dv">100</span>, <span class="dv">360</span>, indexNames, <span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">12</span>, cForwardCurve, <span class="dv">1</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a>indexScen[<span class="dv">1</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, ]</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">#&gt;           [,1]      [,2]      [,3]      [,4]      [,5]</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#&gt; [1,] 0.9280933 0.7108209 1.0542468 1.0391611 1.0050411</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#&gt; [2,] 1.0160765 1.1770017 0.9065351 0.9935556 0.9305910</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt; [3,] 0.9066403 0.9151064 1.2239807 1.0199796 0.9939919</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#&gt; [4,] 1.1897872 0.9397168 0.9853616 1.0115470 1.0117871</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt; [5,] 1.0327826 0.9718774 0.8855638 1.0016170 0.9723979</span></span></code></pre></div>
<p>Then we use <code>genFundScen()</code> to map the index movements to funds according to different allocations of capital using a fund map (stored as default data under variable “fundMap”). The fund movements are also stored in a 3D-array with dimension [number of Scenarios, number of Steps, number of Funds]</p>
</div>
<div id="risk-neutral-path-simulation-for-10-funds" class="section level3">
<h3>Risk-neutral path simulation for 10 funds</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Again, we show the fund simulated path for five months of the first scenario </span></span>
<span id="cb3-2"><a href="#cb3-2"></a>fundScen &lt;-<span class="st"> </span><span class="kw">genFundScen</span>(fundMap, indexScen)</span>
<span id="cb3-3"><a href="#cb3-3"></a>fundScen[<span class="dv">1</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, ]</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">#&gt;           [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">#&gt; [1,] 0.9280933 0.7108209 1.0542468 1.0391611 1.0050411 0.8411844 0.9911700</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">#&gt; [2,] 1.0160765 1.1770017 0.9065351 0.9935556 0.9305910 1.0804466 0.9613058</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">#&gt; [3,] 0.9066403 0.9151064 1.2239807 1.0199796 0.9939919 0.9100268 1.0653105</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt; [4,] 1.1897872 0.9397168 0.9853616 1.0115470 1.0117871 1.0897591 1.0875744</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">#&gt; [5,] 1.0327826 0.9718774 0.8855638 1.0016170 0.9723979 1.0084206 0.9591732</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">#&gt;           [,8]      [,9]     [,10]</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">#&gt; [1,] 0.9836272 0.9512190 0.9474726</span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">#&gt; [2,] 1.0048160 0.9876751 1.0047520</span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">#&gt; [3,] 0.9633100 1.1313184 1.0119398</span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">#&gt; [4,] 1.1006671 0.9716682 1.0276399</span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="co">#&gt; [5,] 1.0171998 0.9114579 0.9728478</span></span></code></pre></div>
</div>
</div>
<div id="generate-a-synthetic-portfolio-of-variable-annuities" class="section level2">
<h2>Generate a synthetic portfolio of variable annuities</h2>
<p>Perhaps the most value-added step in this package is the generation of synthetic portfolio of variable annuities that has realistic charateristic features. Using the fuction <code>genPortInception()</code>, users can generate a synthetic variable annuity portfolio of desirable size. The function <code>genPortInception()</code> has certain predetermined default values based on the research in the package reference. We recommend users to change these default values, such as maturity and issue range, to match their portfolio characteristics. In the current version, there are a few constraints for the portfolio being generated: The issue range must be later than the first date of historical scenario; The maturity range should also be set after the valuation date to be meaningful.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># For illustration purposes, we will only simulate one guarantee contract for each of </span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co"># the 19 guarantee types. Please note that due to randomness the generated portfolio </span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co"># under this code block may not align with the default VAPort under lazy data.</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="cf">if</span>(<span class="kw">capabilities</span>(<span class="st">&quot;long.double&quot;</span>)) {</span>
<span id="cb4-5"><a href="#cb4-5"></a>VAport &lt;-<span class="st"> </span><span class="kw">genPortInception</span>(<span class="dt">issueRng =</span> <span class="kw">c</span>(<span class="st">&quot;2001-08-01&quot;</span>, <span class="st">&quot;2014-01-01&quot;</span>), <span class="dt">numPolicy =</span>  <span class="dv">1</span>)</span>
<span id="cb4-6"><a href="#cb4-6"></a>}</span></code></pre></div>
</div>
<div id="monte-carlo-valuation" class="section level2">
<h2>Monte Carlo Valuation</h2>
<p>After generating the above required elements for Monte Carlo valuation, we can now proceed to calculate the fair market price of the portfolio by calling the function <code>valuatePortfolio()</code>. Under the current version of the package, all the annuity contracts in the portfolio are assumed to be valuated on the same date, i.e. the first date of our simulated fund scenario. Users can either use the default mortality table by calling “mortTable”, or input a mortality table to project liability cash flows.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># In this vignette, we will arbitrarily use the first two scenarios from fundSen to </span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co"># valuate a portfolio of two guarantees to speed up the execution of the example.</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co"># The input cForwardCurve is a vector of 0.02 with dimension 360. </span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="kw">valuatePortfolio</span>(VAPort[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, ], mortTable, fundScen[<span class="dv">1</span>, , ], <span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">12</span>, cForwardCurve)</span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co">#&gt; $portVal</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#&gt; [1] 605.5763</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#&gt; </span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">#&gt; $portRC</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co">#&gt; [1] 1246.656</span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co">#&gt; </span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">#&gt; $vecVal</span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="co">#&gt; [1]   0.0000   0.0000 605.5763   0.0000   0.0000</span></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="co">#&gt; </span></span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="co">#&gt; $vecRC</span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="co">#&gt; [1] 347.58464 249.73990 575.59559  45.55381  28.18163</span></span></code></pre></div>
<p>Note that users can also “age” the portfolio, calling the function <code>agePortfolio()</code>, to a particular valuation date by incorporating the historical fund movements prior to that date.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Again, we will arbitrarily age a portfolio of two guarantees to speed up the execution.</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>targetDate &lt;-<span class="st"> &quot;2016-01-01&quot;</span></span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co"># Here we generate historical fund scenarios using default index data stored under &quot;histIdxScen&quot;</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>histFundScen &lt;-<span class="st"> </span><span class="kw">genFundScen</span>(fundMap, histIdxScen)</span>
<span id="cb6-6"><a href="#cb6-6"></a></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co"># Perform aging</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="kw">agePortfolio</span>(VAPort[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, ], mortTable, histFundScen, histDates, <span class="dt">dT =</span> <span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">12</span>, targetDate, cForwardCurve)</span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt;      recordID survivorShip gender productType  issueDate    matDate  birthDate</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt; DBRP        1            1      M        DBRP 2010-11-01 2036-11-01 1965-07-01</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt; DBRU        2            1      M        DBRU 2013-02-01 2034-02-01 1969-11-01</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">#&gt;      currentDate baseFee riderFee rollUpRate gbAmt gmwbBalance wbWithdrawalRate</span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co">#&gt; DBRP  2016-01-01    0.02   0.0025      5e-04     0           0            5e-04</span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co">#&gt; DBRU  2016-01-01    0.02   0.0035      5e-04     0           0            5e-04</span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co">#&gt;      withdrawal fundNum1 fundNum2 fundNum3 fundNum4 fundNum5 fundNum6 fundNum7</span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="co">#&gt; DBRP          0        1        2        3        4        5        6        7</span></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co">#&gt; DBRU          0        1        2        3        4        5        6        7</span></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="co">#&gt;      fundNum8 fundNum9 fundNum10 fundValue1 fundValue2 fundValue3 fundValue4</span></span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="co">#&gt; DBRP        8        9        10   120788.3  135115.39   90082.35   56505.24</span></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="co">#&gt; DBRU        8        9        10        0.0   54975.59       0.00   44099.64</span></span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="co">#&gt;      fundValue5 fundValue6 fundValue7 fundValue8 fundValue9 fundValue10</span></span>
<span id="cb6-22"><a href="#cb6-22"></a><span class="co">#&gt; DBRP   47943.95   126814.8       0.00       0.00   103083.3    85152.89</span></span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="co">#&gt; DBRU   42005.60        0.0   51996.72   51055.69        0.0        0.00</span></span>
<span id="cb6-24"><a href="#cb6-24"></a><span class="co">#&gt;      fundFee1 fundFee2 fundFee3 fundFee4 fundFee5 fundFee6 fundFee7 fundFee8</span></span>
<span id="cb6-25"><a href="#cb6-25"></a><span class="co">#&gt; DBRP    0.003    0.005    0.006    0.008    0.001   0.0038   0.0045   0.0055</span></span>
<span id="cb6-26"><a href="#cb6-26"></a><span class="co">#&gt; DBRU    0.003    0.005    0.006    0.008    0.001   0.0038   0.0045   0.0055</span></span>
<span id="cb6-27"><a href="#cb6-27"></a><span class="co">#&gt;      fundFee9 fundFee10</span></span>
<span id="cb6-28"><a href="#cb6-28"></a><span class="co">#&gt; DBRP   0.0047    0.0046</span></span>
<span id="cb6-29"><a href="#cb6-29"></a><span class="co">#&gt; DBRU   0.0047    0.0046</span></span></code></pre></div>
</div>
<div id="closing-remarks" class="section level2">
<h2>Closing Remarks</h2>
<p>Though the primary purpose of this package is to valuate a portfolio of variable annuities, users can also use the <code>valuateOnePolicy()</code> and the <code>ageOnePolicy()</code> functions to perform fair market valuation on a single variable annuity as demonstrated below.</p>
<div id="valuation-of-one-variable-annuity" class="section level3">
<h3>Valuation of one variable annuity</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>exPolicy &lt;-<span class="st"> </span>VAPort[<span class="dv">1</span>, ]</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">valuateOnePolicy</span>(exPolicy, mortTable, fundScen[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, , ], <span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">12</span>, cForwardCurve)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co">#&gt; $policyValue</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">#&gt; </span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">#&gt; $riskCharge</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">#&gt; [1] 454.1367</span></span></code></pre></div>
</div>
<div id="aging-of-one-variable-annuity" class="section level3">
<h3>Aging of one variable annuity</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Similarly, users can age this single policy before pricing it. We use the same </span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co"># target date and historical fund scenario as generated before</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>exPolicy &lt;-<span class="st"> </span>VAPort[<span class="dv">1</span>, ]</span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="kw">ageOnePolicy</span>(exPolicy, mortTable, histFundScen, histDates, <span class="dt">dT =</span> <span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">12</span>, targetDate, cForwardCurve)</span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co">#&gt;      recordID survivorShip gender productType  issueDate    matDate  birthDate</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co">#&gt; DBRP        1            1      M        DBRP 2010-11-01 2036-11-01 1965-07-01</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co">#&gt;      currentDate baseFee riderFee rollUpRate gbAmt gmwbBalance wbWithdrawalRate</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">#&gt; DBRP  2016-01-01    0.02   0.0025      5e-04     0           0            5e-04</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co">#&gt;      withdrawal fundNum1 fundNum2 fundNum3 fundNum4 fundNum5 fundNum6 fundNum7</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="co">#&gt; DBRP          0        1        2        3        4        5        6        7</span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">#&gt;      fundNum8 fundNum9 fundNum10 fundValue1 fundValue2 fundValue3 fundValue4</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co">#&gt; DBRP        8        9        10   120788.3   135115.4   90082.35   56505.24</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co">#&gt;      fundValue5 fundValue6 fundValue7 fundValue8 fundValue9 fundValue10</span></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co">#&gt; DBRP   47943.95   126814.8          0          0   103083.3    85152.89</span></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co">#&gt;      fundFee1 fundFee2 fundFee3 fundFee4 fundFee5 fundFee6 fundFee7 fundFee8</span></span>
<span id="cb8-16"><a href="#cb8-16"></a><span class="co">#&gt; DBRP    0.003    0.005    0.006    0.008    0.001   0.0038   0.0045   0.0055</span></span>
<span id="cb8-17"><a href="#cb8-17"></a><span class="co">#&gt;      fundFee9 fundFee10</span></span>
<span id="cb8-18"><a href="#cb8-18"></a><span class="co">#&gt; DBRP   0.0047    0.0046</span></span></code></pre></div>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
